<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="System 36">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="System 36 Golf Handicap Calculator for casual tournaments">
    <title>System 36 Golf Scorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #1e3c72;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input[type="text"], input[type="number"], input[type="file"], select {
            flex: 1;
            min-width: 150px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            min-height: 44px; /* iOS recommended touch target */
            touch-action: manipulation; /* Prevents double-tap zoom */
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        button.danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .player-card {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .player-card:hover {
            transform: scale(1.05);
        }

        .player-card.active {
            box-shadow: 0 0 0 4px #ffd700;
        }

        .player-card h3 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .remove-player {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2em;
            line-height: 1;
        }

        .remove-player:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .scorecard {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        tbody tr:hover {
            background: #e3f2fd;
        }

        .hole-input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        .results-table {
            width: 100%;
            margin-top: 20px;
        }

        .results-table th {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        .winner {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%) !important;
            color: white;
            font-weight: bold;
        }

        .trophy {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #1e3c72;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
        }

        .info-box li {
            margin-bottom: 5px;
            color: #555;
        }

        .hidden {
            display: none;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .save-load-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .saved-rounds {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .saved-round-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .saved-round-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .saved-round-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .saved-round-name {
            font-weight: bold;
            color: #1e3c72;
        }

        .saved-round-date {
            font-size: 0.85em;
            color: #666;
        }

        .saved-round-info {
            font-size: 0.9em;
            color: #555;
        }

        .delete-round {
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.85em;
            cursor: pointer;
        }

        .delete-round:hover {
            background: #e04858;
        }

        #scorecardPreview img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .course-preset {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .course-preset:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .course-preset h4 {
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .course-preset p {
            color: #666;
            font-size: 0.9em;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
                max-width: 100%;
            }

            .section {
                page-break-inside: avoid;
            }

            button, .action-buttons, .save-load-section, .input-group, .remove-player {
                display: none !important;
            }

            .player-card {
                cursor: default;
            }

            .player-card:hover {
                transform: none;
            }

            .scorecard {
                overflow-x: visible;
            }

            table {
                font-size: 0.8em;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .header p {
                font-size: 0.95em;
            }

            .content {
                padding: 15px;
            }

            .section {
                margin-bottom: 20px;
            }

            .section-title {
                font-size: 1.2em;
                margin-bottom: 10px;
            }

            .input-group {
                flex-direction: column;
            }

            input[type="text"], input[type="number"], input[type="file"], select {
                min-width: 100%;
                font-size: 16px; /* Prevents iOS zoom on focus */
                padding: 14px;
            }

            button {
                width: 100%;
                padding: 14px;
                font-size: 1em;
                margin-bottom: 10px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .player-list {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .player-card {
                padding: 20px;
            }

            .player-card h3 {
                font-size: 1.3em;
            }

            .course-preset {
                padding: 18px;
                margin-bottom: 10px;
            }

            .course-preset h4 {
                font-size: 1.1em;
            }

            /* Make scorecard table scrollable horizontally */
            .scorecard {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 0 -15px 20px -15px;
                padding: 0 15px;
            }

            table {
                font-size: 0.7em;
                min-width: 800px; /* Ensures table doesn't compress too much */
            }

            th, td {
                padding: 6px 4px;
                min-width: 35px;
            }

            .hole-input {
                width: 35px;
                padding: 4px;
                font-size: 14px;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-box {
                padding: 12px;
            }

            .stat-label {
                font-size: 0.75em;
            }

            .stat-value {
                font-size: 1.3em;
            }

            .saved-rounds {
                grid-template-columns: 1fr;
            }

            .saved-round-card {
                padding: 15px;
            }

            .info-box {
                padding: 12px;
                font-size: 0.9em;
            }

            .info-box ul {
                margin-left: 15px;
            }

            .info-box li {
                font-size: 0.85em;
            }

            .save-load-section {
                padding: 15px;
            }

            /* Better mobile table styling */
            .results-table {
                font-size: 0.75em;
            }

            .results-table th,
            .results-table td {
                padding: 8px 4px;
            }

            /* Mobile-friendly delete buttons */
            .remove-player,
            .delete-round {
                padding: 8px;
                min-width: 44px;
                min-height: 44px;
            }

            /* Improve touch targets */
            .course-preset,
            .player-card,
            .saved-round-card {
                min-height: 60px;
            }

            /* Hide less important columns on very small screens */
            @media (max-width: 480px) {
                .results-table th:nth-child(4),
                .results-table td:nth-child(4) {
                    display: none; /* Hide "To Par" on very small screens */
                }
                
                table {
                    font-size: 0.65em;
                }
                
                .hole-input {
                    width: 32px;
                    font-size: 12px;
                }

                .header h1 {
                    font-size: 1.4em;
                }

                .stats {
                    grid-template-columns: 1fr;
                }
            }
        }

        /* Landscape orientation on mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.4em;
            }

            .header p {
                font-size: 0.85em;
            }

            .content {
                padding: 10px;
            }

            .section {
                margin-bottom: 15px;
            }
        }

        /* iPad and tablet specific */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 95%;
            }

            .player-list {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Improve touch scrolling */
        .scorecard,
        .saved-rounds,
        .player-list {
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent text selection on buttons */
        button,
        .player-card,
        .course-preset,
        .saved-round-card {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* Allow text selection in inputs */
        input,
        textarea {
            -webkit-user-select: text;
            user-select: text;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚õ≥ System 36 Golf Scorer</h1>
            <p>Fair handicap calculation for casual tournaments</p>
        </div>

        <div class="content">
            <div class="info-box">
                <h4>How System 36 Works:</h4>
                <ul>
                    <li><strong>Par or better:</strong> 2 points per hole</li>
                    <li><strong>Bogey (+1):</strong> 1 point per hole</li>
                    <li><strong>Double bogey or worse:</strong> 0 points</li>
                    <li><strong>Handicap:</strong> 36 - Total Points</li>
                    <li><strong>Net Score:</strong> Gross Score - Handicap</li>
                </ul>
                <p style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #90caf9; color: #1565c0;">
                    <strong>‚ú® New!</strong> Upload your course scorecard image and AI will automatically extract the par values for all 18 holes!
                </p>
            </div>

            <div class="save-load-section">
                <h2 class="section-title">Save & Load Rounds</h2>
                <div class="action-buttons">
                    <input 
                        type="text"
                        id="roundName"
                        placeholder="Round name (e.g., Lombok Kosaido - Nov 18)"
                        style="flex: 2; min-width: 200px;"
                    />
                    <button onclick="saveRound()">üíæ Save Current Round</button>
                    <button onclick="clearCurrent()" class="danger">üóëÔ∏è Clear Current</button>
                    <button onclick="printRound()">üñ®Ô∏è Print Results</button>
                </div>
                <div id="savedRoundsList" class="saved-rounds"></div>
            </div>

            <div class="save-load-section">
                <h2 class="section-title">Import Course Scorecard</h2>
                <p style="color: #666; margin-bottom: 10px;">Upload an image of your course scorecard to reference while entering hole data:</p>
                <div class="action-buttons">
                    <input 
                        type="file" 
                        id="scorecardImage" 
                        accept="image/*"
                        onchange="handleScorecardUpload(this)"
                        style="flex: 1;"
                    />
                    <button id="clearImageButton" onclick="clearScorecardImage()" class="hidden danger">
                        üóëÔ∏è Clear Image
                    </button>
                </div>
                <div id="scorecardPreview" style="margin-top: 15px;"></div>
                <div id="scorecardDataEntry" class="hidden" style="margin-top: 20px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #667eea;">
                    <h3 style="color: #1e3c72; margin-bottom: 15px;">Course Data <span id="extractedLabel" class="hidden" style="color: #00c853; font-size: 0.9em;">(Auto-Extracted)</span></h3>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Course Name:</label>
                        <input type="text" id="courseName" placeholder="e.g., Sira Beach Golf Club" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Select Tees:</label>
                        <select id="teeSelection" style="width: 100%;">
                            <option value="championship">Championship (Black/Gold)</option>
                            <option value="mens">Men's (Blue)</option>
                            <option value="ladies">Ladies (Red)</option>
                            <option value="senior">Senior (White)</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div style="grid-column: 1 / -1; font-weight: bold; color: #1e3c72; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                            Front 9 - Hole Pars
                        </div>
                        <div><label>Hole 1:</label><input type="number" id="par1" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 2:</label><input type="number" id="par2" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 3:</label><input type="number" id="par3" min="3" max="6" value="3" class="hole-input"></div>
                        <div><label>Hole 4:</label><input type="number" id="par4" min="3" max="6" value="5" class="hole-input"></div>
                        <div><label>Hole 5:</label><input type="number" id="par5" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 6:</label><input type="number" id="par6" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 7:</label><input type="number" id="par7" min="3" max="6" value="3" class="hole-input"></div>
                        <div><label>Hole 8:</label><input type="number" id="par8" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 9:</label><input type="number" id="par9" min="3" max="6" value="5" class="hole-input"></div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div style="grid-column: 1 / -1; font-weight: bold; color: #1e3c72; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                            Back 9 - Hole Pars
                        </div>
                        <div><label>Hole 10:</label><input type="number" id="par10" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 11:</label><input type="number" id="par11" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 12:</label><input type="number" id="par12" min="3" max="6" value="3" class="hole-input"></div>
                        <div><label>Hole 13:</label><input type="number" id="par13" min="3" max="6" value="5" class="hole-input"></div>
                        <div><label>Hole 14:</label><input type="number" id="par14" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 15:</label><input type="number" id="par15" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 16:</label><input type="number" id="par16" min="3" max="6" value="3" class="hole-input"></div>
                        <div><label>Hole 17:</label><input type="number" id="par17" min="3" max="6" value="4" class="hole-input"></div>
                        <div><label>Hole 18:</label><input type="number" id="par18" min="3" max="6" value="5" class="hole-input"></div>
                    </div>
                    <button onclick="applyScorecardData()" style="width: 100%;">Apply Scorecard Data</button>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Course Setup</h2>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #1e3c72; margin-bottom: 10px; font-size: 1.1em;">Quick Course Presets:</h3>
                    <div class="course-preset" onclick="loadSiraBeach()">
                        <h4>üèñÔ∏è Sira Beach Golf Club</h4>
                        <p>Par 72 ‚Ä¢ 6,245m ‚Ä¢ Sire Bay, Lombok</p>
                    </div>
                    <div class="course-preset" onclick="loadStandardCourse()">
                        <h4>‚õ≥ Standard Par 72 Course</h4>
                        <p>Par 72 ‚Ä¢ Traditional layout</p>
                    </div>
                    <div id="customPresetsContainer"></div>
                </div>
                
                <div class="input-group">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <strong>Course Par:</strong>
                        <input 
                            type="number" 
                            id="coursePar"
                            value="72"
                            style="flex: none; width: 80px;"
                        />
                    </label>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Add Players</h2>
                <div class="input-group">
                    <input 
                        type="text"
                        id="playerName"
                        placeholder="Player name"
                    />
                    <button onclick="addPlayer()">Add Player</button>
                </div>

                <div id="playerList" class="player-list"></div>
            </div>

            <div id="scoringSection" class="section hidden">
                <h2 class="section-title">Score Entry - <span id="currentPlayerName"></span></h2>
                
                <div id="currentCourseInfo" style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none;">
                    <strong>Current Course:</strong> <span id="currentCourseName"></span> | 
                    <strong>Tees:</strong> <span id="currentTees"></span> | 
                    <strong>Par:</strong> <span id="currentPar"></span>
                </div>
                
                <div class="scorecard">
                    <table>
                        <thead>
                            <tr>
                                <th>Hole</th>
                                <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th>
                                <th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th>
                                <th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="parRow">
                                <td><strong>Par</strong></td>
                            </tr>
                            <tr id="scoreRow">
                                <td><strong>Score</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="playerStats" class="stats"></div>
            </div>

            <div id="resultsSection" class="section hidden">
                <h2 class="section-title">Results</h2>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Gross Score</th>
                            <th>To Par</th>
                            <th>S36 Points</th>
                            <th>Handicap</th>
                            <th>Net Score</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let players = [];
        let selectedPlayerId = null;
        let holePars = [4, 4, 3, 5, 4, 4, 3, 4, 5, 4, 4, 3, 5, 4, 4, 3, 4, 5];
        let currentCourse = {
            name: '',
            tees: '',
            pars: []
        };
        let uploadedImageData = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializePars();
            updateCoursePar();
            loadSavedRounds();
            renderSavedRoundsList();
            loadCustomPresets();
            
            document.getElementById('playerName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addPlayer();
            });
            
            document.getElementById('roundName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') saveRound();
            });
        });

        function loadCustomPresets() {
            const savedCourses = JSON.parse(localStorage.getItem('golfCourses') || '[]');
            const container = document.getElementById('customPresetsContainer');
            
            if (savedCourses.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const headerDiv = document.createElement('div');
            headerDiv.style.marginTop = '15px';
            headerDiv.style.paddingTop = '15px';
            headerDiv.style.borderTop = '2px solid #e0e0e0';
            headerDiv.innerHTML = '<h4 style="color: #667eea; margin-bottom: 10px; font-size: 1em;">Your Saved Courses:</h4>';
            
            container.innerHTML = '';
            container.appendChild(headerDiv);
            
            savedCourses.forEach((course, index) => {
                const totalPar = course.pars.reduce((sum, par) => sum + par, 0);
                const teeColor = getTeeColorEmoji(course.tees);
                const preset = document.createElement('div');
                preset.className = 'course-preset';
                preset.style.position = 'relative';
                
                // Create the content first
                const contentDiv = document.createElement('div');
                contentDiv.innerHTML = `
                    <h4>${teeColor} ${course.name}</h4>
                    <p>Par ${totalPar} ‚Ä¢ ${course.tees} tees</p>
                `;
                
                // Create delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.style.position = 'absolute';
                deleteBtn.style.top = '10px';
                deleteBtn.style.right = '10px';
                deleteBtn.style.background = '#f5576c';
                deleteBtn.style.padding = '4px 8px';
                deleteBtn.style.fontSize = '0.8em';
                deleteBtn.style.border = 'none';
                deleteBtn.style.borderRadius = '4px';
                deleteBtn.style.color = 'white';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.textContent = 'Delete';
                
                // Use closure to capture course data
                const courseName = course.name;
                const courseTees = course.tees;
                
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    deleteCustomCourseByName(courseName, courseTees);
                });
                
                preset.addEventListener('click', function() { 
                    loadCustomCourse(index); 
                });
                
                preset.appendChild(contentDiv);
                preset.appendChild(deleteBtn);
                container.appendChild(preset);
            });
        }
        
        function deleteCustomCourseByName(name, tees) {
            console.log('Delete clicked for:', name, tees);
            if (confirm(`Delete "${name}" (${tees} tees)?`)) {
                console.log('User confirmed deletion');
                let savedCourses = JSON.parse(localStorage.getItem('golfCourses') || '[]');
                console.log('Courses before delete:', savedCourses.length);
                savedCourses = savedCourses.filter(c => !(c.name === name && c.tees === tees));
                console.log('Courses after delete:', savedCourses.length);
                localStorage.setItem('golfCourses', JSON.stringify(savedCourses));
                console.log('Saved to localStorage, reloading presets...');
                loadCustomPresets();
            } else {
                console.log('User cancelled deletion');
            }
        }

        function getTeeColorEmoji(teeType) {
            const teeMap = {
                'championship': '‚ö´',
                'mens': 'üîµ',
                'ladies': 'üî¥',
                'senior': '‚ö™',
                'custom': 'üü°'
            };
            return teeMap[teeType] || '‚õ≥';
        }

        function loadCustomCourse(index) {
            const savedCourses = JSON.parse(localStorage.getItem('golfCourses') || '[]');
            const course = savedCourses[index];
            
            if (course) {
                holePars = course.pars;
                currentCourse = {
                    name: course.name,
                    tees: course.tees,
                    pars: course.pars
                };
                
                const parInputs = document.querySelectorAll('#parRow input');
                parInputs.forEach((input, i) => {
                    input.value = holePars[i];
                });
                
                updateCoursePar();
                updateCourseInfo();
                render();
            }
        }


        function initializePars() {
            const parRow = document.getElementById('parRow');
            for (let i = 0; i < 18; i++) {
                const td = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'hole-input';
                input.value = holePars[i];
                input.min = 3;
                input.max = 5;
                input.onchange = function() {
                    holePars[i] = parseInt(this.value) || 4;
                    updateCoursePar();
                    render();
                };
                td.appendChild(input);
                parRow.appendChild(td);
            }
            
            const totalTd = document.createElement('td');
            totalTd.innerHTML = '<strong id="parTotal">72</strong>';
            parRow.appendChild(totalTd);
        }

        function updateCoursePar() {
            const total = holePars.reduce((sum, par) => sum + par, 0);
            document.getElementById('coursePar').value = total;
            document.getElementById('parTotal').textContent = total;
        }

        function loadSiraBeach() {
            // Sira Beach Golf Club (Lombok Kosaido) - Update these values with actual scorecard
            holePars = [4, 4, 3, 5, 4, 4, 3, 4, 5, 4, 5, 3, 5, 4, 3, 4, 4, 4];
            currentCourse = {
                name: 'Sira Beach Golf Club',
                tees: 'championship',
                pars: holePars
            };
            
            const parInputs = document.querySelectorAll('#parRow input');
            parInputs.forEach((input, i) => {
                input.value = holePars[i];
            });
            
            updateCoursePar();
            updateCourseInfo();
            render();
        }

        function loadStandardCourse() {
            holePars = [4, 4, 3, 5, 4, 4, 3, 4, 5, 4, 4, 3, 5, 4, 4, 3, 4, 5];
            currentCourse = {
                name: 'Standard Par 72 Course',
                tees: 'mens',
                pars: holePars
            };
            
            const parInputs = document.querySelectorAll('#parRow input');
            parInputs.forEach((input, i) => {
                input.value = holePars[i];
            });
            
            updateCoursePar();
            updateCourseInfo();
            render();
        }

        function handleScorecardUpload(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImageData = e.target.result;
                    
                    const preview = document.getElementById('scorecardPreview');
                    preview.innerHTML = `
                        <div style="position: relative;">
                            <img src="${e.target.result}" alt="Scorecard" style="max-width: 100%; border-radius: 8px; cursor: pointer;" onclick="this.style.maxWidth = this.style.maxWidth === '100%' ? 'none' : '100%'">
                            <p style="color: #666; margin-top: 10px; font-size: 0.9em;">
                                <strong>Click image to zoom.</strong> Reference this scorecard to enter the par values below.
                            </p>
                        </div>
                    `;
                    
                    // Show the clear button
                    const clearBtn = document.getElementById('clearImageButton');
                    if (clearBtn) clearBtn.classList.remove('hidden');
                    
                    // Show the data entry form
                    const dataEntry = document.getElementById('scorecardDataEntry');
                    if (dataEntry) {
                        dataEntry.classList.remove('hidden');
                        // Scroll to data entry
                        dataEntry.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function clearScorecardImage() {
            console.log('Clearing scorecard image...');
            
            // Clear the uploaded image data
            uploadedImageData = null;
            
            // Clear the file input
            const fileInput = document.getElementById('scorecardImage');
            if (fileInput) {
                fileInput.value = '';
            }
            
            // Hide and clear preview
            const preview = document.getElementById('scorecardPreview');
            if (preview) {
                preview.innerHTML = '';
            }
            
            // Hide clear button
            const clearBtn = document.getElementById('clearImageButton');
            if (clearBtn) {
                clearBtn.classList.add('hidden');
            }
            
            // Hide data entry form
            const dataEntry = document.getElementById('scorecardDataEntry');
            if (dataEntry) {
                dataEntry.classList.add('hidden');
            }
            
            console.log('Scorecard image cleared');
        }


        function applyScorecardData() {
            const courseName = document.getElementById('courseName').value.trim();
            const teeSelection = document.getElementById('teeSelection').value;
            
            // Collect all par values
            const newPars = [];
            for (let i = 1; i <= 18; i++) {
                const parValue = parseInt(document.getElementById(`par${i}`).value) || 4;
                newPars.push(parValue);
            }
            
            // Update global holePars and current course
            holePars = [...newPars];
            currentCourse = {
                name: courseName || 'Custom Course',
                tees: teeSelection,
                pars: [...newPars]
            };
            
            // Update the par inputs in the scorecard table
            const parInputs = document.querySelectorAll('#parRow input');
            if (parInputs.length === 18) {
                parInputs.forEach((input, i) => {
                    input.value = holePars[i];
                });
            }
            
            updateCoursePar();
            updateCourseInfo();
            render();
            
            // Save course as a preset
            if (courseName) {
                const coursePreset = {
                    name: courseName,
                    tees: teeSelection,
                    pars: [...newPars],
                    date: new Date().toISOString()
                };
                
                let savedCourses = JSON.parse(localStorage.getItem('golfCourses') || '[]');
                // Check if course already exists
                const existingIndex = savedCourses.findIndex(c => c.name === courseName && c.tees === teeSelection);
                if (existingIndex >= 0) {
                    savedCourses[existingIndex] = coursePreset;
                } else {
                    savedCourses.push(coursePreset);
                }
                localStorage.setItem('golfCourses', JSON.stringify(savedCourses));
                
                loadCustomPresets();
            }
            
            // Hide the data entry form and clear button
            const dataEntry = document.getElementById('scorecardDataEntry');
            if (dataEntry) {
                dataEntry.classList.add('hidden');
            }
            const clearBtn = document.getElementById('clearImageButton');
            if (clearBtn) {
                clearBtn.classList.add('hidden');
            }
            
            // Clear the scorecard image
            clearScorecardImage();
            
            // Scroll to course setup
            document.querySelector('.section').scrollIntoView({ behavior: 'smooth' });
        }

        function updateCourseInfo() {
            if (currentCourse.name) {
                const infoDiv = document.getElementById('currentCourseInfo');
                const teeEmoji = getTeeColorEmoji(currentCourse.tees);
                const totalPar = holePars.reduce((sum, par) => sum + par, 0);
                
                document.getElementById('currentCourseName').textContent = currentCourse.name;
                document.getElementById('currentTees').textContent = `${teeEmoji} ${currentCourse.tees}`;
                document.getElementById('currentPar').textContent = totalPar;
                infoDiv.style.display = 'block';
            }
        }

        function addPlayer() {
            const nameInput = document.getElementById('playerName');
            const name = nameInput.value.trim();
            
            if (name) {
                const player = {
                    id: Date.now(),
                    name: name,
                    scores: Array(18).fill('')
                };
                players.push(player);
                nameInput.value = '';
                
                if (!selectedPlayerId) {
                    selectedPlayerId = player.id;
                }
                
                render();
            }
        }

        function removePlayer(id) {
            players = players.filter(p => p.id !== id);
            if (selectedPlayerId === id) {
                selectedPlayerId = players.length > 0 ? players[0].id : null;
            }
            render();
        }

        function selectPlayer(id) {
            selectedPlayerId = id;
            render();
        }

        function updateScore(playerId, holeIndex, value) {
            const player = players.find(p => p.id === playerId);
            if (player) {
                player.scores[holeIndex] = value;
                render();
            }
        }

        function calculateSystem36Points(scores) {
            return scores.reduce((total, score, index) => {
                const numScore = parseInt(score) || 0;
                const par = holePars[index];
                
                if (numScore === 0) return total;
                if (numScore <= par) return total + 2;
                if (numScore === par + 1) return total + 1;
                return total;
            }, 0);
        }

        function calculateResults() {
            const coursePar = holePars.reduce((sum, par) => sum + par, 0);
            
            return players.map(player => {
                const grossScore = player.scores.reduce((sum, score) => sum + (parseInt(score) || 0), 0);
                const system36Points = calculateSystem36Points(player.scores);
                const handicap = 36 - system36Points;
                const netScore = grossScore - handicap;
                const scoreToPar = grossScore - coursePar;

                return {
                    ...player,
                    grossScore,
                    system36Points,
                    handicap,
                    netScore,
                    scoreToPar
                };
            }).sort((a, b) => a.netScore - b.netScore);
        }

        // Save/Load Functions
        function saveRound() {
            if (players.length === 0) {
                alert('Please add players before saving.');
                return;
            }

            const roundNameInput = document.getElementById('roundName');
            const roundName = roundNameInput.value.trim() || `Round ${new Date().toLocaleDateString()}`;
            
            const roundData = {
                id: Date.now(),
                name: roundName,
                date: new Date().toISOString(),
                players: players,
                holePars: holePars,
                coursePar: holePars.reduce((sum, par) => sum + par, 0)
            };

            let savedRounds = JSON.parse(localStorage.getItem('golfRounds') || '[]');
            savedRounds.push(roundData);
            localStorage.setItem('golfRounds', JSON.stringify(savedRounds));

            roundNameInput.value = '';
            renderSavedRoundsList();
        }

        function loadSavedRounds() {
            return JSON.parse(localStorage.getItem('golfRounds') || '[]');
        }

        function loadRound(id) {
            const savedRounds = loadSavedRounds();
            const round = savedRounds.find(r => r.id === id);
            
            if (round) {
                players = round.players;
                holePars = round.holePars;
                selectedPlayerId = players.length > 0 ? players[0].id : null;
                
                const parInputs = document.querySelectorAll('#parRow input');
                parInputs.forEach((input, i) => {
                    input.value = holePars[i];
                });
                
                updateCoursePar();
                render();
                
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function deleteRound(id) {
            if (confirm('Are you sure you want to delete this saved round?')) {
                let savedRounds = loadSavedRounds();
                savedRounds = savedRounds.filter(r => r.id !== id);
                localStorage.setItem('golfRounds', JSON.stringify(savedRounds));
                renderSavedRoundsList();
            }
        }

        function clearCurrent() {
            if (confirm('Clear all current players and scores?')) {
                players = [];
                selectedPlayerId = null;
                render();
            }
        }

        function printRound() {
            if (players.length === 0) {
                alert('Please add players before printing.');
                return;
            }
            window.print();
        }

        function renderSavedRoundsList() {
            const savedRounds = loadSavedRounds();
            const listDiv = document.getElementById('savedRoundsList');
            
            if (savedRounds.length === 0) {
                listDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No saved rounds yet. Save your current round above!</p>';
                return;
            }

            listDiv.innerHTML = '';
            
            savedRounds.slice().reverse().forEach(round => {
                const date = new Date(round.date);
                const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const playerCount = round.players.length;
                
                const card = document.createElement('div');
                card.className = 'saved-round-card';
                card.onclick = function() { loadRound(round.id); };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-round';
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = function(e) {
                    e.stopPropagation();
                    deleteRound(round.id);
                };
                
                card.innerHTML = `
                    <div class="saved-round-header">
                        <div>
                            <div class="saved-round-name">${round.name}</div>
                            <div class="saved-round-date">${dateStr}</div>
                        </div>
                    </div>
                    <div class="saved-round-info">
                        ${playerCount} player${playerCount !== 1 ? 's' : ''} ‚Ä¢ Par ${round.coursePar}
                    </div>
                `;
                
                card.querySelector('.saved-round-header').appendChild(deleteBtn);
                listDiv.appendChild(card);
            });
        }

        function render() {
            renderPlayerList();
            renderScoreEntry();
            renderResults();
        }

        function renderPlayerList() {
            const playerList = document.getElementById('playerList');
            playerList.innerHTML = '';

            players.forEach(player => {
                const card = document.createElement('div');
                card.className = 'player-card' + (player.id === selectedPlayerId ? ' active' : '');
                card.onclick = () => selectPlayer(player.id);
                
                card.innerHTML = `
                    <div class="remove-player" onclick="event.stopPropagation(); removePlayer(${player.id})">√ó</div>
                    <h3>${player.name}</h3>
                    <p>Click to enter scores</p>
                `;
                
                playerList.appendChild(card);
            });
        }

        function renderScoreEntry() {
            const section = document.getElementById('scoringSection');
            const currentPlayer = players.find(p => p.id === selectedPlayerId);
            
            if (!currentPlayer) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            document.getElementById('currentPlayerName').textContent = currentPlayer.name;
            
            const scoreRow = document.getElementById('scoreRow');
            scoreRow.innerHTML = '<td><strong>Score</strong></td>';
            
            for (let i = 0; i < 18; i++) {
                const td = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'hole-input';
                input.value = currentPlayer.scores[i];
                input.min = 1;
                input.max = 15;
                input.onchange = function() {
                    updateScore(currentPlayer.id, i, this.value);
                };
                td.appendChild(input);
                scoreRow.appendChild(td);
            }
            
            const totalScore = currentPlayer.scores.reduce((sum, s) => sum + (parseInt(s) || 0), 0);
            const totalTd = document.createElement('td');
            totalTd.innerHTML = `<strong>${totalScore}</strong>`;
            scoreRow.appendChild(totalTd);
            
            const statsDiv = document.getElementById('playerStats');
            const points = calculateSystem36Points(currentPlayer.scores);
            
            if (points > 0) {
                const handicap = 36 - points;
                const netScore = totalScore - handicap;
                
                statsDiv.innerHTML = `
                    <div class="stat-box">
                        <div class="stat-label">System 36 Points</div>
                        <div class="stat-value">${points}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Handicap</div>
                        <div class="stat-value">${handicap}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Gross Score</div>
                        <div class="stat-value">${totalScore}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Net Score</div>
                        <div class="stat-value">${netScore}</div>
                    </div>
                `;
            } else {
                statsDiv.innerHTML = '';
            }
        }

        function renderResults() {
            const section = document.getElementById('resultsSection');
            const resultsBody = document.getElementById('resultsBody');
            
            const results = calculateResults();
            const hasScores = results.some(r => r.grossScore > 0);
            
            if (!hasScores || players.length === 0) {
                section.classList.add('hidden');
                return;
            }
            
            section.classList.remove('hidden');
            resultsBody.innerHTML = '';
            
            results.forEach((player, index) => {
                if (player.grossScore > 0) {
                    const tr = document.createElement('tr');
                    if (index === 0) tr.className = 'winner';
                    
                    tr.innerHTML = `
                        <td>${index === 0 ? '<span class="trophy">üèÜ</span>' : ''}${index + 1}</td>
                        <td><strong>${player.name}</strong></td>
                        <td>${player.grossScore}</td>
                        <td>${player.scoreToPar > 0 ? '+' : ''}${player.scoreToPar}</td>
                        <td>${player.system36Points}</td>
                        <td>${player.handicap}</td>
                        <td><strong>${player.netScore}</strong></td>
                    `;
                    
                    resultsBody.appendChild(tr);
                }
            });
        }
    </script>
</body>
</html>
